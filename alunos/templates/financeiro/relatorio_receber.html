{% extends 'base.html' %}
{% load static %}

{% block title %}Relatório a Receber{% endblock %}

{% block content %}
<style>
  * { font-family: 'Inter', sans-serif; }
  .form-label { font-weight: 600; font-size: 0.95rem; }
  .form-input { width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 0.95rem; }
  .btn-filtrar { background-color: #2563eb; color: white; padding: 0.5rem 1rem; font-weight: 500; border-radius: 0.5rem; transition: background 0.3s; text-align: center; display: inline-block; }
  .btn-filtrar:hover { background-color: #1d4ed8; }
  .btn-limpar { background-color: #dc2626; color: white; padding: 0.5rem 1rem; font-weight: 500; border-radius: 0.5rem; transition: background 0.3s; text-align: center; display: inline-block; }
  .btn-limpar:hover { background-color: #b91c1c; }
  .tabela-relatorio { width: 100%; border-collapse: collapse; margin-bottom: 2rem; }
  .tabela-relatorio th, .tabela-relatorio td {
    padding: 0.6rem 0.75rem;
    border-bottom: 1px solid #e5e7eb;
    font-size: 0.92rem;
  }
  .tabela-relatorio th { background-color: #f3f4f6; text-align: left; font-weight: 600; }
  .tabela-relatorio tbody tr:nth-child(even) { background-color: #f9fafb; }
  .section-title { font-size: 1.1rem; font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.75rem; color: #2563eb; border-bottom: 2px solid #2563eb; padding-bottom: 0.2rem; }
  .totais-container { display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem; padding-top: 0.5rem; border-top: 1px solid #e5e7eb; }
  @media (min-width: 768px) { .totais-container { flex-direction: row; justify-content: space-between; align-items: center; } }
  .total-item { display: flex; gap: 0.4rem; font-weight: 600; font-size: 1rem; }
  .total-item span:last-child { font-weight: bold; }
  .btn-exportar-pdf { display: inline-flex; align-items: center; background-color: #dc2626; color: white; font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.5rem; text-decoration: none; transition: background 0.3s, transform 0.2s; }
  .btn-exportar-pdf:hover { background-color: #b91c1c; transform: translateY(-2px); }
  .pagination { margin-top: 1rem; display: flex; gap: 0.5rem; align-items: center; }
  .pagination a { padding: 0.4rem 0.8rem; border: 1px solid #2563eb; border-radius: 0.4rem; font-size: 0.9rem; color: #2563eb; background: transparent; text-decoration: none; transition: all 0.2s; }
  .pagination a:hover { background-color: #2563eb; color: white; }
  .pagination span { font-size: 0.9rem; color: #374151; }
  .footer-dev { margin-top: 2rem; font-size: 0.75rem; color: #6b7280; text-align: center; }
  /* Ícones de ação */
  .action-icons a { display: inline-flex; align-items: center; justify-content: center; transition: transform 0.2s ease-in-out, color 0.2s ease-in-out; }
  .action-icons a:hover { transform: scale(1.1); }
  .action-edit svg { stroke: #4b5563; }
  .action-edit:hover svg { stroke: #111827; }
  .action-delete svg { stroke: #dc2626; }
  .action-delete:hover svg { stroke: #991b1b; }
</style>

<div class="max-w-5xl mx-auto pt-4 animate-fade-in">
  <div class="bg-white rounded-2xl p-6 shadow-md border" style="border-width: 0.5px; border-color: rgba(37, 99, 235, 0.4);">
    <h2 class="text-xl font-bold text-blue-700 mb-4 flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 1.25rem; height: 1.25rem; margin-right: 0.5rem;">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3v18h18M9 17V9M15 17V5" />
      </svg>
      Relatório de Valores Recebidos
    </h2>

  <form method="get" class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6 items-end">
      <!-- Data Início -->
      <div class="flex flex-col">
        <label for="data_inicio" class="form-label flex items-center gap-2 text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          Data Início
        </label>
        <input type="date" name="data_inicio" id="data_inicio" value="{{ data_inicio|date:'Y-m-d' }}" class="form-input rounded-full shadow-sm focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition h-10">
      </div>

      <!-- Data Fim -->
      <div class="flex flex-col">
        <label for="data_fim" class="form-label flex items-center gap-2 text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          Data Fim
        </label>
        <input type="date" name="data_fim" id="data_fim" value="{{ data_fim|date:'Y-m-d' }}" class="form-input rounded-full shadow-sm focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition h-10">
      </div>

      <!-- Método de Pagamento -->
      <div class="flex flex-col">
        <label for="metodo_pagamento" class="form-label flex items-center gap-2 text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2 7h20M2 11h20M6 15h2m4 0h6a2 2 0 002-2V7a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/>
          </svg>
          Pagamento
        </label>
        <select name="metodo_pagamento" id="metodo_pagamento" class="form-input rounded-full shadow-sm focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition h-10">
          <option value="">Todos</option>
          {% for metodo in metodos_pagamento %}
            <option value="{{ metodo.id }}" {% if metodo.id|stringformat:"s" == metodo_pagamento_id %}selected{% endif %}>{{ metodo.metodo }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Botão Filtrar -->
      <div class="flex flex-col justify-end">
        <button type="submit" class="btn-filtrar w-full">Filtrar</button>
      </div>

      <!-- Botão Limpar -->
      <div class="flex flex-col justify-end">
        <a href="{% url 'relatorio_receber' %}" class="btn-limpar w-full">Limpar</a>
      </div>
    </form>

    {# Pagamentos de Alunos #}
    <div>
      <h3 class="section-title">Pagamentos de Alunos</h3>
      <table class="tabela-relatorio">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Valor Pago</th>
            <th>Data Pagamento</th>
            <th>Método</th>
            <th style="text-align:center;">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% if alunos %}
            {% for aluno in alunos %}
            <tr>
              <td>{{ aluno.nome }}</td>
              <td>R$ {{ aluno.valor_pago }}</td>
              <td>{{ aluno.data_pagamento|date:'d/m/Y' }}</td>
              <td>{{ aluno.metodo_pagamento }}</td>
              <td class="action-icons flex justify-center gap-3">
                <a href="{% url 'update_pagamento' aluno.pk %}"  class="action-edit" title="Editar pagamento">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" width="20" height="20">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4 12.5-12.5z"/>
                  </svg>
                </a>
                <a href="#" class="action-delete" title="Excluir pagamento">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" width="20" height="20">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 7H5M10 11v6M14 11v6M6 7l1 12a2 2 0 002 2h6a2 2 0 002-2l1-12"/>
                  </svg>
                </a>
              </a>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" class="text-center text-gray-500 py-4">Nenhum pagamento de aluno encontrado.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    {# Vendas de Produtos #}
    <div>
      <h3 class="section-title">Vendas de Produtos</h3>
      <table class="tabela-relatorio">
        <thead>
          <tr>
            <th>Produto</th>
            <th>Valor</th>
            <th>Data Venda</th>
            <th>Método</th>
            <th style="text-align:center;">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% if vendas %}
            {% for venda in vendas %}
            <tr>
              <td>{{ venda.nome_produto }}</td>
              <td>R$ {{ venda.valor_produto }}</td>
              <td>{{ venda.data_venda|date:'d/m/Y' }}</td>
              <td>{{ venda.metodo_pagamento }}</td>
              <td class="action-icons flex justify-center gap-3">
                <a href="{% url 'update_venda' venda.id%}" class="action-edit" title="Editar venda">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" width="20" height="20">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4 12.5-12.5z"/>
                  </svg>
                <a href="{% url 'delete_venda' venda.id %}" class="action-delete" title="Excluir venda">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" width="20" height="20">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 7H5M10 11v6M14 11v6M6 7l1 12a2 2 0 002 2h6a2 2 0 002-2l1-12"/>
                  </svg>
                </a>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" class="text-center text-gray-500 py-4">Nenhuma venda de produto encontrada.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    {# Totais e PDF #}
    <div class="totais-container">
      <div class="flex flex-col md:flex-row gap-6">
        <div class="total-item">
          <span>Total Pagamentos de Alunos:</span>
          <span>R$ {{ total_pago_alunos }}</span>
        </div>
        <div class="total-item">
          <span>Total Vendas de Produtos:</span>
          <span>R$ {{ total_pago_vendas }}</span>
        </div>
        <div class="total-item">
          <span>Total Geral:</span>
          <span>R$ {{ total_geral }}</span>
        </div>
      </div>

      <a href="{% url 'exportar_relatorio_receber_pdf' %}?data_inicio={{ data_inicio }}&data_fim={{ data_fim }}&metodo_pagamento={{ metodo_pagamento_id }}" 
         class="btn-exportar-pdf mt-2 md:mt-0 flex items-center gap-2"
         target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
          <path d="M19 2H8a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7l-5-5zM8 20V4h10v5h5v11H8z"/>
        </svg>
        Exportar PDF
      </a>
    </div>
  </div>
    </td>
</div>
{% endblock %}
