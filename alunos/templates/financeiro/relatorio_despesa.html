{% extends 'base.html' %}
{% load static %}

{% block title %}Relatório de Despesas{% endblock %}

{% block content %}
<style>
  * { font-family: 'Inter', sans-serif; }
  .form-label { font-weight: 600; font-size: 0.95rem; }
  .form-input { width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 0.95rem; }
  .btn-filtrar { background-color: #2563eb; color: white; padding: 0.5rem 1rem; font-weight: 500; border-radius: 0.5rem; transition: background 0.3s; text-align: center; display: inline-block; }
  .btn-filtrar:hover { background-color: #1d4ed8; }
  .btn-limpar { background-color: #dc2626; color: white; padding: 0.5rem 1rem; font-weight: 500; border-radius: 0.5rem; transition: background 0.3s; text-align: center; display: inline-block; }
  .btn-limpar:hover { background-color: #b91c1c; }

  .btn-exportar-pdf {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    background-color: #dc2626;
    color: white;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    text-decoration: none;
    transition: background 0.3s, transform 0.2s;
  }
  .btn-exportar-pdf:hover { background-color: #b91c1c; transform: translateY(-1px); }

  .tabela-relatorio { width: 100%; border-collapse: collapse; margin-bottom: 2rem; }
  .tabela-relatorio th, .tabela-relatorio td { padding: 0.6rem 0.75rem; border-bottom: 1px solid #e5e7eb; font-size: 0.92rem; }
  .tabela-relatorio th { background-color: #f3f4f6; text-align: left; font-weight: 600; }
  .tabela-relatorio tbody tr:nth-child(even) { background-color: #f9fafb; }
  .section-title { font-size: 1.1rem; font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.75rem; color: #2563eb; border-bottom: 2px solid #2563eb; padding-bottom: 0.2rem; }

  .totais-container {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    margin-top: 2rem;
    font-weight: 600;
    font-size: 1rem;
    align-items: center;
  }
  .total-item { display: flex; gap: 0.4rem; align-items: center; }

  /* Ícones */
  .action-icons a { display: inline-flex; align-items: center; justify-content: center; transition: transform 0.2s ease-in-out, color 0.2s ease-in-out; }
  .action-icons a:hover { transform: scale(1.1); }
  .action-icons svg { width: 1.25rem; height: 1.25rem; stroke-width: 2; }
  .action-edit { color: #4b5563; }
  .action-edit:hover { color: #111827; }
  .action-delete { color: #dc2626; }
  .action-delete:hover { color: #991b1b; }
</style>

<div class="max-w-5xl mx-auto pt-4 animate-fade-in">
  <div class="bg-white rounded-2xl p-6 shadow-md border" style="border-width: 0.5px; border-color: rgba(37, 99, 235, 0.4);">
    <h2 class="text-xl font-bold text-blue-700 mb-4 flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 1.25rem; height: 1.25rem; margin-right: 0.5rem;">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3v18h18M9 17V9M15 17V5" />
      </svg>
      Relatório de Despesas
    </h2>

    <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 items-end">
      <div>
        <label for="data_inicio" class="form-label text-gray-700">Data Início</label>
        <input type="date" name="data_inicio" id="data_inicio" value="{{ data_inicio|default:''|date:'Y-m-d' }}" class="form-input rounded-full shadow-sm">
      </div>
      <div>
        <label for="data_fim" class="form-label text-gray-700">Data Fim</label>
        <input type="date" name="data_fim" id="data_fim" value="{{ data_fim|default:''|date:'Y-m-d' }}" class="form-input rounded-full shadow-sm">
      </div>
      <div>
        <button type="submit" class="btn-filtrar w-full">Filtrar</button>
      </div>
      <div>
        <a href="{% url 'relatorio_despesas' %}" class="btn-limpar w-full">Limpar</a>
      </div>
    </form>

    <h3 class="section-title">Despesas</h3>
    <table class="tabela-relatorio">
      <thead>
        <tr>
          <th>Descrição</th>
          <th>Valor</th>
          <th>Data</th>
          <th style="text-align:center;">Ações</th>
        </tr>
      </thead>
      <tbody>
        {% if despesas %}
          {% for despesa in despesas %}
          <tr>
            <td>{{ despesa.nome }}</td>
            <td>R$ {{ despesa.valor_despesa|floatformat:2 }}</td>
            <td>{{ despesa.data_despesa|date:'d/m/Y' }}</td>
            <td class="action-icons flex justify-center gap-3">
              <a href="{% url 'update_despesa' despesa.pk %}" class="action-edit" title="Editar despesa">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 20h9"/>
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4 12.5-12.5z"/>
                </svg>
              </a>
              <a href="{% url 'delete_despesa' despesa.pk%}" class="action-delete" title="Excluir despesa">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 7H5M10 11v6M14 11v6M6 7l1 12a2 2 0 002 2h6a2 2 0 002-2l1-12"/>
                </svg>
              </a>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="4" class="text-center text-gray-500 py-4">Nenhuma despesa encontrada.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>

    <!-- Total Geral + Botão Exportar PDF alinhados -->
    <div class="totais-container">
      <div class="total-item">
        <span>Total Geral:</span>
        <span>R$ {{ total_geral|floatformat:2 }}</span>
      </div>
      <a href="{% url 'exportar_relatorio_despesas_pdf' %}?data_inicio={{ data_inicio }}&data_fim={{ data_fim }}"
   class="btn-exportar-pdf"
   target="_blank">
   <svg xmlns="http://www.w3.org/2000/svg" class="inline w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
       <path d="M19 2H8a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7l-5-5zM8 20V4h10v5h5v11H8z"/>
   </svg>
   Exportar PDF
</a>

    </div>
  </div>
</div>
{% endblock %}
