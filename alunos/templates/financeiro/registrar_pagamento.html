{% extends 'base.html' %}

{% block title %}Registrar Pagamento{% endblock %}

{% block content %}
<style>
  * {
    font-family: 'Inter', sans-serif;
  }
  label {
    font-weight: 600;
    color: #1e3a8a; /* Azul escuro */
  }
</style>

<!-- CSS e JS do Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<div class="max-w-2xl mx-auto mt-16 p-8 bg-blue-50 border border-blue-400 rounded-2xl shadow-lg animate-fade-in">
  <h1 class="text-2xl font-bold text-blue-900 mb-6 text-center">Registrar Pagamento de Aluno</h1>

  {% if messages %}
    <div class="mb-6">
      {% for message in messages %}
        <p class="text-center font-semibold
          {% if message.tags == 'error' %}text-red-600{% elif message.tags == 'success' %}text-green-600{% else %}text-gray-700{% endif %}">
          {{ message }}
        </p>
      {% endfor %}
    </div>
  {% endif %}

  <form method="post" class="space-y-5" novalidate>
    {% csrf_token %}

    <div>
      <label for="aluno">Aluno</label>
      <select name="aluno" id="aluno" required>
        <option value="">Selecione um aluno</option>
        {% for aluno in alunos %}
          <option value="{{ aluno.id }}">{{ aluno.nome }} ({{ aluno.cpf|default:"-" }})</option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label for="valor_pago">Valor Pago (R$)</label>
      <input type="number" name="valor_pago" id="valor_pago" min="0" step="0.01" required placeholder="Ex: 129.00">
    </div>

    <div>
      <label for="data_pagamento">Data do Pagamento</label>
      <input type="date" name="data_pagamento" id="data_pagamento" value="{{ hoje }}" required>
    </div>

    <div>
      <label for="metodo_pagamento">Método de Pagamento</label>
      <select name="metodo_pagamento" id="metodo_pagamento" required>
        <option value="">Selecione um método</option>
        {% for metodo in metodos_pagamento %}
          <option value="{{ metodo.id }}">{{ metodo.metodo }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="flex justify-end gap-4 pt-4">
      <a href="{% url 'lista_alunos' %}" 
         class="px-5 py-2 rounded-xl border border-gray-400 bg-white text-gray-700 hover:bg-gray-100 transition">
        Cancelar
      </a>
      <button type="submit" 
              class="px-5 py-2 rounded-xl bg-blue-600 text-white font-semibold hover:bg-blue-700 transition">
        Registrar Pagamento
      </button>
    </div>
  </form>
</div>

<script>
  // Aplica estilos padronizados aos campos
  document.querySelectorAll('input, select, textarea').forEach(el => {
    el.classList.add(
      'w-full', 'px-4', 'py-2', 'border', 'border-gray-300', 
      'rounded-lg', 'focus:outline-none', 'focus:ring-2', 
      'focus:ring-blue-400', 'bg-white'
    );
  });

  // Ativa busca no campo de aluno
  $(document).ready(function() {
    $('#aluno').select2({
      placeholder: "Selecione ou pesquise um aluno",
      allowClear: true
    });
  });
</script>
{% endblock %}
